<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Log</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/js/all.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Lato:wght@100;300;400;700;900&family=Roboto+Condensed:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        .custom-scrollbar::-webkit-scrollbar {
            width: 12px;
            background-color: #F5F5F5;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            border-radius: 10px;
            background-color: #993aec;
        }

        .sub-items {
            display: none;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }
    </style>
</head>

<body class="bg-gray-100">
    <div
        class="w-1/5 bg-gradient-to-b h-screen fixed from-purple-300 via-purple-400 to-purple-600 p-4 rounded-2xl overflow-y-auto custom-scrollbar">
        <nav id="sidebar">
            <ul class="space-y-4">
                <li><a href="../Home/home.html"
                        class="block text-center bg-white text-black font-bold py-3 rounded-xl hover:bg-gray-200">Home</a>
                </li>
                <li><a href="../course outline/outline.html"
                        class="block text-center bg-white text-black font-bold py-3 rounded-xl hover:bg-gray-200">Course
                        Outline</a></li>
                <li><a href="../course description/resdes.html"
                        class="block text-center bg-white text-black font-bold py-3 rounded-xl hover:bg-gray-200">Course
                        Description</a></li>
                <li><a href="../Copy of lecture notes/notes.html"
                        class="block text-center bg-white text-black font-bold py-3 rounded-xl hover:bg-gray-200">Lecture
                        Notes</a></li>
                <li><a href="../Copy of Question papers/papers.html"
                        class="block text-center bg-white text-black font-bold py-3 rounded-xl hover:bg-gray-200">Question
                        Papers</a></li>
                <li><a href="../Model solution/modelsol.html"
                        class="block text-center bg-white text-black font-bold py-3 rounded-xl hover:bg-gray-200">Model
                        Solutions</a></li>
                <li><a href="../samples/samples.html"
                        class="block text-center bg-white text-black font-bold py-3 rounded-xl hover:bg-gray-200">Samples</a>
                </li>
                <li><a href="../Course log/courselog.html"
                        class="block text-center bg-white text-black font-bold py-3 rounded-xl hover:bg-gray-200">Course
                        Log</a></li>
                <li><a href="../Outcome Assesment/assesment.html"
                        class="block text-center bg-white text-black font-bold py-3 rounded-xl hover:bg-gray-200">Outcome
                        Assessment</a></li>
                <li><a href="../Course folder verfication report/resverf.html"
                        class="block text-center bg-white text-black font-bold py-3 rounded-xl hover:bg-gray-200">Course
                        Folder Verification</a></li>
                <li id="manage-login-btn"><a href="../Manage logins/managelogin.html"
                        class="block text-center bg-white text-black font-bold py-3 rounded-xl hover:bg-gray-200">Manage
                        Login</a></li>
                <li><a href="./login/login.html"
                        class="block text-center bg-white text-black font-bold py-3 rounded-xl hover:bg-gray-200">Logout</a>
                </li>
            </ul>
        </nav>
    </div>
    <div class="ml-[calc(100vw/5)] p-8">
        <div class="w-full bg-white border-2 border-gray-600 rounded-lg p-6">
            <!-- Header Section -->
            <div class="flex items-center justify-center gap-6 mb-4">
                <img src="./assets/Nceac.png" alt="NCEAC logo" class="h-12 w-24" />
                <div class="text-center font-bold text-xl">
                    National Computing Education Accreditation Council
                    <span class="block">NCEAC</span>
                </div>
                <img src="./assets/heclogo.png" alt="HEC logo" class="h-20 w-24" />
            </div>

            <hr class="w-4/5 mx-auto h-1 bg-black rounded my-4" />

            <!-- Document Number -->
            <div class="text-right mr-20 mb-4">NCEAC.DOC.001-E</div>

            <!-- Title -->
            <h1 class="text-2xl font-bold text-center mb-8">Course Log</h1>

            <!-- Institution Section -->
            <div class="ml-24 mb-4 flex gap-32">
                <div class="font-bold">INSTITUTION</div>
                <div class="border-b border-black w-[30rem]">
                    Abbottabad University of Science & Technology
                </div>
            </div>

            <!-- Program Section -->
            <div class="ml-24 mb-8 flex gap-16">
                <div class="font-bold w-40">PROGRAM (s) TO BE EVALUATED</div>
                <div class="border-b border-black w-[30rem]">
                    <input type="text" class="w-full outline-none" id="program-evaluated" />
                </div>
            </div>

            <!-- Course Details Table -->
            <div class="ml-24 mb-8">
                <table class="border-collapse">
                    <tr>
                        <td class="border border-black p-2 w-36 font-bold">Course Name</td>
                        <td class="border border-black p-2 w-[35rem]">
                            <input type="text" class="w-full outline-none" id="course-name" />
                        </td>
                    </tr>
                    <tr>
                        <td class="border border-black p-2 font-bold">Catalog Number</td>
                        <td class="border border-black p-2">
                            <input type="number" class="w-full outline-none" id="catalog-number" />
                        </td>
                    </tr>
                    <tr>
                        <td class="border border-black p-2 font-bold">Instructor Name</td>
                        <td class="border border-black p-2">
                            <input type="text" class="w-full outline-none" id="instructor-name" />
                        </td>
                    </tr>
                </table>
            </div>

            <!-- Main Log Table -->
            <div class="ml-24 mb-8">
                <table class="border-collapse w-[42rem]" id="log-table">
                    <thead>
                        <tr>
                            <th class="border border-black p-2 w-24 text-center">Date</th>
                            <th class="border border-black p-2 w-24 text-center">Duration</th>
                            <th class="border border-black p-2 w-72 text-center">Topic Covered</th>
                            <th class="border border-black p-2 w-24 text-center">Evaluation Instrument used</th>
                            <th class="border border-black p-2 w-24 text-center">Signature</th>
                        </tr>
                    </thead>
                    <tbody id="log-rows"></tbody>
                </table>
            </div>

            <!-- Footer Section -->
            <div class="ml-24 mt-16">
                <div class="flex gap-4 mb-2">
                    <span class="font-bold">Name of Instructor:</span>
                    <input type="text" class="border-b border-black w-64 outline-none" id="instructor-footer" />
                </div>
                <div class="flex gap-4 mb-2">
                    <span class="font-bold">Signature:</span>
                    <input type="text" class="border-b border-black w-64 outline-none" id="signature-footer" />
                </div>
                <div class="flex gap-4 mb-8">
                    <span class="font-bold">Date:</span>
                    <input type="text" class="border-b border-black w-64 outline-none" id="date-footer" />
                </div>

                <div class="flex gap-4 mb-8">
                    <button class="bg-gray-800 text-white px-8 py-2 rounded-2xl hover:bg-purple-600 transition-colors"
                        id="submit-btn">
                        Submit
                    </button>
                    <button class="bg-gray-800 text-white px-8 py-2 rounded-2xl hover:bg-purple-600 transition-colors">
                        Print
                    </button>
                </div>

                <div class="flex justify-between mr-24 text-sm mb-8">
                    <div>Page 1 of 3</div>
                    <div>NCEAC.DOC.001-E</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const courseValue = localStorage.getItem("course");
            const instructorValue = localStorage.getItem("teacher");
            const classValue = localStorage.getItem("class");
            const session = localStorage.getItem("session");
    
            const courseName = document.getElementById("course-name");
            const instructorName = document.getElementById("instructor-name");
    
            // Set the course and instructor values on page load
            courseName.value = courseValue;
            instructorName.value = instructorValue;
    
            // Function to generate log rows dynamically
            function generateRows() {
                const tbody = document.getElementById('log-rows');
                for (let i = 0; i < 34; i++) {
                    const row = document.createElement('tr');
                    row.className = i % 2 === 1 ? "bg-gray-200" : "";
    
                    // Create each cell with corresponding IDs
                    row.innerHTML = `
                        <td class="border border-black p-2">
                            <input type="date" class="w-full outline-none bg-transparent" id="date-${i}" />
                        </td>
                        <td class="border border-black p-2">
                            <input type="text" class="w-full outline-none bg-transparent" value="" id="duration-${i}" />
                        </td>
                        <td class="border border-black p-2">
                            <textarea rows="4" class="w-full outline-none resize-none bg-transparent" id="topic-${i}"></textarea>
                        </td>
                        <td class="border border-black p-2">
                            <input type="text" class="w-full outline-none bg-transparent" id="evaluation-${i}" />
                        </td>
                        <td class="border border-black p-2">
                            <input type="text" class="w-full outline-none bg-transparent" id="signature-${i}" />
                        </td>
                    `;
    
                    tbody.appendChild(row);
                }
            }
    
            // Generate rows on page load
            window.onload = generateRows;
    
            // Function to collect all data from the form and prepare it for posting
            const collectFormData = () => {
                const formData = {
                    catalogNumber: document.getElementById("catalog-number").value,
                    logEntries: []
                };
    
                // Collect all the rows from the table
                const logRows = document.querySelectorAll("#log-rows tr");
                logRows.forEach(row => {
                    const date = row.querySelector("[id^='date-']").value;
                    const duration = row.querySelector("[id^='duration-']").value;
                    const topic = row.querySelector("[id^='topic-']").value;
                    const evaluationInstrument = row.querySelector("[id^='evaluation-']").value;
                    const signature = row.querySelector("[id^='signature-']").value;
    
                    // Add row data to the log entries
                    formData.logEntries.push({
                        date,
                        duration,
                        topic,
                        evaluationInstrument,
                        signature
                    });
                });
    
                return formData;
            };
    
            // Function to fetch existing course log data from the server
            const fetchLogData = async () => {
                const headers = {
                    courseName: courseValue,
                    instructorName: instructorValue,
                    className: classValue,
                    session: session
                };

                
    
                try {
                    const response = await fetch("http://localhost:5000/api/teacher/course/course-log", {
                        method: "GET",
                        headers: {
                            "Content-Type": "application/json",
                            ...headers
                        }
                    });
    
                    if (response.ok) {
                        const data = await response.json();
                        populateForm(data);
                    } else {
                        const errorData = await response.json();
                        alert("Error fetching data: " + errorData.message);
                    }
                } catch (error) {
                    console.error("Error fetching data:", error);
                    alert("An error occurred while fetching the data.");
                }
            };
    
            // Function to populate the form with the fetched data
            const populateForm = (data) => {
                // Assuming data contains log entries with date, duration, topic, evaluationInstrument, signature
                const logEntries = data.logEntries || [];
    
                logEntries.forEach((log, i) => {
                    if (i < 34) { // Only populate up to 34 rows                        
                        document.getElementById(`date-${i}`).value = log.date || '';
                        document.getElementById(`duration-${i}`).value = log.duration || '';
                        document.getElementById(`topic-${i}`).value = log.topic || '';
                        document.getElementById(`evaluation-${i}`).value = log.evaluationInstrument || '';
                        document.getElementById(`signature-${i}`).value = log.signature || '';
                    }
                });
            };
    
            // Fetch the existing course log data on page load
            fetchLogData();
    
            // Submit the data to the API
            const submitData = async () => {
                const data = collectFormData();
    
                // Prepare the headers with the course, instructor, class, and session values
                const headers = {
                    courseName: courseValue,
                    instructorName: instructorValue,
                    className: classValue,
                    session: session
                };
    
                // Send the data to the API
                try {
                    const response = await fetch("http://localhost:5000/api/teacher/course/course-log", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            ...headers
                        },
                        body: JSON.stringify(data)
                    });
    
                    if (response.ok) {
                        alert("Data submitted successfully");
                    } else {
                        const errorData = await response.json();
                        alert("Error: " + errorData.message);
                    }
                } catch (error) {
                    console.error("Error submitting data:", error);
                    alert("An error occurred while submitting the data.");
                }
            };
    
            // Handle form submission
            document.getElementById("submit-btn").addEventListener("click", (e) => {
                e.preventDefault();
                submitData();
            });
        });
    </script>
    

</body>

</html>